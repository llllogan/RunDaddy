<section class="mx-auto w-full" [ngClass]="step === 'plan' ? 'max-w-5xl' : 'max-w-md'">
  <div class="mb-8 text-left">
    <p class="text-sm font-medium text-gray-600">Get started</p>
    <h1 class="mt-2 text-3xl font-semibold text-gray-900">Create Company</h1>
    <p class="mt-2 text-sm text-gray-600">
      We will set up your organization and owner dashboard access in one step.
    </p>
  </div>

  <form class="space-y-6" [formGroup]="form" (ngSubmit)="submit()">
    @if (step === 'details') {
      <label class="block text-sm font-medium text-gray-700">
        Company name
        <input
          class="mt-2 w-full rounded-md border border-gray-300 bg-white px-4 py-2 text-base text-gray-900 outline-none transition focus:border-gray-400 focus:ring-2 focus:ring-gray-200"
          type="text"
          formControlName="companyName"
          autocomplete="organization"
          placeholder="Acme Logistics"
        />
      </label>
    }

    @if (step === 'details') {
      <div class="grid gap-4 sm:grid-cols-2">
        <label class="block text-sm font-medium text-gray-700">
          First name
          <input
            class="mt-2 w-full rounded-md border border-gray-300 bg-white px-4 py-2 text-base text-gray-900 outline-none transition focus:border-gray-400 focus:ring-2 focus:ring-gray-200"
            type="text"
            formControlName="userFirstName"
            autocomplete="given-name"
            placeholder="Sloan"
          />
        </label>

        <label class="block text-sm font-medium text-gray-700">
          Last name
          <input
            class="mt-2 w-full rounded-md border border-gray-300 bg-white px-4 py-2 text-base text-gray-900 outline-none transition focus:border-gray-400 focus:ring-2 focus:ring-gray-200"
            type="text"
            formControlName="userLastName"
            autocomplete="family-name"
            placeholder="Rivera"
          />
        </label>
      </div>

      <label class="block text-sm font-medium text-gray-700">
        Your email
        <input
          class="mt-2 w-full rounded-md border border-gray-300 bg-white px-4 py-2 text-base text-gray-900 outline-none transition focus:border-gray-400 focus:ring-2 focus:ring-gray-200"
          type="email"
          formControlName="userEmail"
          autocomplete="email"
          placeholder="owner@acme.com"
        />
      </label>

      <label class="block text-sm font-medium text-gray-700">
        Password
        <input
          class="mt-2 w-full rounded-md border border-gray-300 bg-white px-4 py-2 text-base text-gray-900 outline-none transition focus:border-gray-400 focus:ring-2 focus:ring-gray-200"
          type="password"
          formControlName="userPassword"
          autocomplete="new-password"
          placeholder="Create a secure password"
        />
      </label>

      <label class="block text-sm font-medium text-gray-700">
        Phone (optional)
        <input
          class="mt-2 w-full rounded-md border border-gray-300 bg-white px-4 py-2 text-base text-gray-900 outline-none transition focus:border-gray-400 focus:ring-2 focus:ring-gray-200"
          type="tel"
          formControlName="userPhone"
          autocomplete="tel"
          placeholder="(555) 123-4567"
        />
      </label>
    } @else {
      <div class="space-y-6">
        <div class="text-left">
          <p class="text-sm font-medium text-gray-500">Step 2</p>
          <h2 class="mt-2 text-2xl font-semibold text-gray-900">Choose your plan</h2>
          <p class="mt-2 text-sm text-gray-600">
            Compare included seats and tools. You can change tiers anytime in Stripe.
          </p>
        </div>

        <div class="grid gap-4 lg:grid-cols-3">
          <label
            *ngFor="let plan of planOptions"
            class="flex h-full flex-col gap-4 rounded-2xl border bg-white p-5 text-left text-sm text-gray-700 shadow-sm transition"
            [ngClass]="
              form.get('tierId')?.value === plan.id
                ? 'border-gray-900 ring-2 ring-gray-900'
                : 'border-gray-200 hover:border-gray-300'
            "
          >
            <div class="flex items-start justify-between gap-3">
              <div>
                @if (plan.badge) {
                  <span class="inline-flex rounded-full border border-gray-200 px-3 py-1 text-xs font-semibold text-gray-600">
                    {{ plan.badge }}
                  </span>
                }
                <h3 class="mt-3 text-xl font-semibold text-gray-900">{{ plan.name }}</h3>
                <p class="mt-2 text-sm text-gray-600">{{ plan.description }}</p>
              </div>
              <input
                class="mt-1 h-4 w-4 text-gray-900 focus:ring-gray-300"
                type="radio"
                formControlName="tierId"
                [value]="plan.id"
              />
            </div>

            <div class="flex items-baseline gap-2">
              <span class="text-2xl font-semibold text-gray-900">{{ plan.price }}</span>
              <span class="text-xs font-semibold text-gray-500">Per month</span>
            </div>

            <ul class="space-y-2 text-sm text-gray-600">
              <li *ngFor="let feature of plan.features" class="flex items-start gap-2">
                <svg
                  class="mt-0.5 h-4 w-4 flex-none text-gray-900"
                  viewBox="0 0 20 20"
                  fill="currentColor"
                  aria-hidden="true"
                >
                  <path
                    fill-rule="evenodd"
                    d="M16.704 5.29a1 1 0 0 1 0 1.415l-7.41 7.409a1 1 0 0 1-1.415 0L3.296 9.621a1 1 0 1 1 1.415-1.414l3.084 3.083 6.703-6.702a1 1 0 0 1 1.415 0Z"
                    clip-rule="evenodd"
                  />
                </svg>
                <span>{{ feature }}</span>
              </li>
            </ul>
          </label>
        </div>
      </div>
    }

    <button
      class="w-full rounded-full bg-gray-900 px-4 py-2 text-sm font-semibold text-white transition hover:bg-gray-800 disabled:cursor-not-allowed disabled:opacity-60"
      type="submit"
      [disabled]="form.invalid || isSubmitting || (step === 'details' && requiresPhoneCode)"
    >
      @if (step === 'details') {
        {{ isSubmitting ? 'Saving details…' : 'Next' }}
      } @else {
        {{ isSubmitting ? 'Redirecting…' : 'Continue to billing' }}
      }
    </button>
  </form>

  <p *ngIf="errorMessage" class="mt-6 rounded-md border border-rose-100 bg-rose-50 px-4 py-3 text-sm text-rose-700">
    {{ errorMessage }}
  </p>

  <div class="mt-8 text-left">
    <p class="text-sm text-gray-600">Already registered?</p>
    <a class="mt-2 inline-flex text-sm font-semibold text-gray-800 hover:text-gray-900" routerLink="/login">
      Back to log in
    </a>
  </div>
</section>

<section class="space-y-8">

  <div class="space-y-4">
    @if (errorMessage) {
      <div class="rounded-2xl border border-rose-100 bg-rose-50 px-4 py-3 text-sm text-rose-800">{{ errorMessage }}</div>
    }

    @if (isLoading) {
      <div class="rounded-xl border border-dashed border-slate-200 bg-white px-6 py-5 text-center text-sm text-slate-600">
        Loading your teamâ€¦
      </div>
    } @else {
      <div class="rounded-xl border border-slate-200 bg-white overflow-hidden">
        @if (people.length === 0) {
          <div class="px-6 py-10 text-center text-sm text-slate-500">Invite teammates to see them listed here.</div>
        } @else {
          <div class="overflow-x-auto">
            <table class="min-w-full table-auto border-collapse text-sm text-slate-800">
              <colgroup>
                <col style="width: 34%" />
                <col style="width: 22%" />
                <col style="width: 30%; min-width: 320px" />
                <col style="width: 14%; min-width: 150px" />
              </colgroup>
              <thead>
                <tr class="bg-slate-50 text-xs font-semibold uppercase tracking-wide text-slate-500">
                  <th scope="col" class="px-6 py-4 text-left align-bottom">Member</th>
                  <th scope="col" class="px-6 py-4 text-left align-bottom">Contact</th>
                  <th scope="col" class="px-6 py-4 text-left align-bottom">Role</th>
                  <th scope="col" class="px-6 py-4 text-left align-bottom">Actions</th>
                </tr>
              </thead>
              <tbody>
                @let session = session$ | async;
                @let membershipRole = session?.company?.role ?? session?.user?.role ?? null;
                @let canManage = membershipRole === 'OWNER' || membershipRole === 'ADMIN' || membershipRole === 'GOD';
                @let isPlatformAdminCompany = session?.platformAdminCompanyId && session?.company?.id === session?.platformAdminCompanyId;
                @for (person of people; track trackByPersonId($index, person)) {
                  <tr class="border-t border-slate-100">
                    <td class="px-6 py-5 align-top">
                      <div class="space-y-1">
                        <p class="font-semibold leading-snug text-slate-900">{{ person.firstName }} {{ person.lastName }}</p>
                        <p class="text-xs uppercase tracking-wide text-slate-500">ID {{ person.id }}</p>
                      </div>
                    </td>
                    <td class="px-6 py-5 align-top">
                      <div class="space-y-1">
                        <p class="text-slate-900">{{ person.email }}</p>
                        @if (person.phone) {
                          <p class="text-xs text-slate-500">{{ person.phone }}</p>
                        }
                      </div>
                    </td>
                    <td class="px-6 py-5 align-top">
                      <div class="flex gap-2 flex-wrap lg:flex-nowrap">
                        @for (roleOption of roleOptions; track roleOption.value) {
                          @if (isPlatformAdminCompany || roleOption.value !== 'GOD') {
                            <button
                              type="button"
                              class="rounded-md px-3 py-1 text-xs font-semibold uppercase tracking-wide transition disabled:cursor-not-allowed disabled:opacity-40"
                              [class.bg-blue-50]="person.role === roleOption.value"
                              [class.text-blue-700]="person.role === roleOption.value"
                              [class.text-blue-600]="person.role !== roleOption.value"
                              [disabled]="
                                !canManage ||
                                isRoleBusy(person.id) ||
                                isRemoveBusy(person.id) ||
                                person.role === roleOption.value
                              "
                              (click)="changeRole(person, roleOption.value)"
                            >
                              {{ roleOption.label }}
                            </button>
                          }
                        }
                      </div>
                    </td>
                    <td class="px-6 py-5 align-top whitespace-nowrap">
                      <button
                        type="button"
                        class="rounded-md px-4 py-1 text-xs font-semibold uppercase tracking-wide text-blue-600 transition hover:bg-blue-50 disabled:cursor-not-allowed disabled:opacity-50"
                        (click)="removePerson(person)"
                        [disabled]="!canManage || isRemoveBusy(person.id) || isRoleBusy(person.id)"
                      >
                        Remove
                      </button>
                    </td>
                  </tr>
                }
              </tbody>
            </table>
          </div>
        }
      </div>
    }
  </div>
</section>

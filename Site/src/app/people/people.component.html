<section class="space-y-8">

  <div class="space-y-4">
    @if (errorMessage) {
      <div class="rounded-2xl border border-rose-100 bg-rose-50 px-4 py-3 text-sm text-rose-800">{{ errorMessage }}</div>
    }

    @if (isLoading) {
      <div class="px-6 py-5 text-center text-sm text-slate-600">Loading your teamâ€¦</div>
    } @else {
      <div class="rounded-xl border border-slate-200 bg-white overflow-hidden">
        @if (people.length === 0) {
          <div class="px-6 py-10 text-center text-sm text-slate-500">Invite teammates to see them listed here.</div>
        } @else {
          <div class="overflow-x-auto">
            @let session = session$ | async;
            @let membershipRole = session?.company?.role ?? session?.user?.role ?? null;
            @let canManage = membershipRole === 'OWNER' || membershipRole === 'ADMIN' || membershipRole === 'GOD';
            @let isPlatformAdminCompany =
              session?.platformAdminCompanyId && session?.company?.id === session?.platformAdminCompanyId;
            <table mat-table [dataSource]="people" class="min-w-full text-sm text-slate-800">
              <ng-container matColumnDef="member">
                <th
                  mat-header-cell
                  *matHeaderCellDef
                  class="px-6 py-4 text-left align-middle text-xs font-semibold uppercase tracking-wide text-slate-500"
                >
                  Member
                </th>
                <td mat-cell *matCellDef="let person" class="px-6 py-5 align-middle">
                  <div class="space-y-1">
                    <p class="font-semibold leading-snug text-slate-900">{{ person.firstName }} {{ person.lastName }}</p>
                  </div>
                </td>
              </ng-container>

              <ng-container matColumnDef="contact">
                <th
                  mat-header-cell
                  *matHeaderCellDef
                  class="px-6 py-4 text-left align-middle text-xs font-semibold uppercase tracking-wide text-slate-500"
                >
                  Contact
                </th>
                <td mat-cell *matCellDef="let person" class="px-6 py-5 align-middle">
                  <div class="space-y-1">
                    <p class="text-slate-900">{{ person.email }}</p>
                    @if (person.phone) {
                      <p class="text-xs text-slate-500">{{ person.phone }}</p>
                    }
                  </div>
                </td>
              </ng-container>

              <ng-container matColumnDef="role">
                <th
                  mat-header-cell
                  *matHeaderCellDef
                  class="px-6 py-4 text-left align-middle text-xs font-semibold uppercase tracking-wide text-slate-500"
                >
                  Role
                </th>
                <td mat-cell *matCellDef="let person" class="px-6 py-5 align-middle">
                  <div class="flex flex-wrap gap-2 lg:flex-nowrap">
                    @for (roleOption of roleOptions; track roleOption.value) {
                      @if (isPlatformAdminCompany || roleOption.value !== 'GOD') {
                        <button
                          type="button"
                          class="rounded-md px-3 py-1 text-xs font-semibold uppercase tracking-wide transition disabled:cursor-not-allowed disabled:opacity-40"
                          [class.bg-blue-50]="person.role === roleOption.value"
                          [class.text-blue-700]="person.role === roleOption.value"
                          [class.text-blue-600]="person.role !== roleOption.value"
                          [disabled]="
                            !canManage ||
                            isRoleBusy(person.id) ||
                            isRemoveBusy(person.id) ||
                            person.role === roleOption.value
                          "
                          (click)="changeRole(person, roleOption.value)"
                        >
                          {{ roleOption.label }}
                        </button>
                      }
                    }
                  </div>
                </td>
              </ng-container>

              <ng-container matColumnDef="actions">
                <th
                  mat-header-cell
                  *matHeaderCellDef
                  class="px-6 py-4 text-left align-middle text-xs font-semibold uppercase tracking-wide text-slate-500"
                >
                  Actions
                </th>
                <td mat-cell *matCellDef="let person" class="px-6 py-5 align-middle whitespace-nowrap">
                  <button
                    type="button"
                    class="rounded-md px-4 py-1 text-xs font-semibold uppercase tracking-wide text-blue-600 transition hover:bg-blue-50 disabled:cursor-not-allowed disabled:opacity-50"
                    (click)="removePerson(person)"
                    [disabled]="!canManage || isRemoveBusy(person.id) || isRoleBusy(person.id)"
                  >
                    Remove
                  </button>
                </td>
              </ng-container>

              <tr mat-header-row *matHeaderRowDef="displayedColumns" class="bg-slate-50"></tr>
              <tr
                mat-row
                *matRowDef="let row; columns: displayedColumns"
                class="border-t border-slate-100 align-middle"
              ></tr>
            </table>
          </div>
        }
      </div>
    }
  </div>
</section>
